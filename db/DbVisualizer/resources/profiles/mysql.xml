<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE DatabaseProfile SYSTEM "dbvis-defs.dtd">

<!--
   Copyright (c) DbVis Software AB. All Rights Reserved.
-->

<DatabaseProfile
        desc="Profile for MySQL"
        version="$Revision: 17471 $"
        date="$Date: 2014-04-01 22:44:32 +0200 (Tue, 01 Apr 2014) $"
        minver="9.1"
        extends="generic">

   <!-- 
    Profile Notes
    =============
      2006-11-01:
        - Don't run "SHOW TABLE STATUS FOR xxx" when getting result set
          that will be presented in the tree for MySQL 4 and older. Read more
          in: http://www.dbvis.com/forum/thread.jspa?threadID=1744

    Change Log
    ==========
      2007-09-11:
        - Now show Columns and Indexes as child objects for Table objects
      2006-09-18:
        - Added "Empty Table" action for table nodes
      2006-08-18:
        - "Databases" node now display all databases in grid view
      2006-08-16:
        - Now possible to Create Function and Create Procedure
   -->

   <!-- =================================================================== -->
   <!-- Definition of the commands                                          -->
   <!-- =================================================================== -->

   <Commands extends="true">

      <!--
        The "getTableNamesFor" command is used by Database getTableNamesFor().
        It must return table names for the catalog and schema named by
        the ${table_catalog} and ${table_catalog} variables in the first
        column.
      -->
      <Command id="mysql.getTableNamesFor">
        <SQL>
        <![CDATA[
SHOW TABLES FROM `${table_catalog}`
            ]]>
        </SQL>
      </Command>

      <!--
        The "getColumnNamesFor" command is used by Database getColumnNamesFor().
        It must return column names for the catalog, schema and table named by
        the ${table_catalog}, ${table_catalog} and ${table_name} variables in
        the first column.
      -->
      <Command id="mysql.getColumnNamesFor">
        <SQL>
          <![CDATA[
SHOW COLUMNS FROM `${table_catalog}`.`${table_name}`
            ]]>
        </SQL>   
      </Command>

      <!-- =================================================================== -->
      <!-- Here follows all <Command>'s -->
      <!-- =================================================================== -->

      <!--
	     Special replacement for the generic getCatalogs. This returns one
	     record with the default database only. This is useful if "show databases"
	     is disabled. Set the driver property DBNAME = <database> to make this
	     work. Read more in: http://www.dbvis.com/forum/thread.jspa?threadID=2676
      -->
      <Command id="mysql.getSingleDatabase">
        <SQL>
          <![CDATA[
select "${#dp.SINGLE_DBNAME}"
            ]]>
        </SQL>
      </Command>

      <Command id="mysql.getColumns">
         <SQL>
            <![CDATA[
SHOW FULL COLUMNS FROM `${catalog}`.`${table}`
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getTables">
         <If test="#dm.getDatabaseMajorVersion() gte 5">
            <SQL>
               <![CDATA[
SELECT
    TABLE_NAME,
    TABLE_TYPE,
    ENGINE,
    VERSION,
    ROW_FORMAT,
    TABLE_ROWS,
    AVG_ROW_LENGTH,
    DATA_LENGTH,
    MAX_DATA_LENGTH,
    INDEX_LENGTH,
    DATA_FREE,
    AUTO_INCREMENT,
    CREATE_TIME,
    UPDATE_TIME,
    CHECK_TIME,
    TABLE_COLLATION,
    CHECKSUM,
    CREATE_OPTIONS
FROM
    information_schema.tables
WHERE
    table_schema = '${catalog}'
    and table_type ${type}
ORDER BY
    TABLE_NAME
               ]]>
            </SQL>
         </If>
         <Else>
            <SQL>
               <![CDATA[
show tables from `${catalog}`
               ]]>
            </SQL>
         </Else>
      </Command>

      <Command id="mysql.getTableNames">
         <If test="#dm.getDatabaseMajorVersion() gte 5">
            <SQL>
               <![CDATA[
SHOW FULL TABLES FROM `${catalog}` WHERE `table_type` ${type}
               ]]>
            </SQL>
         </If>
         <Else>
            <SQL>
               <![CDATA[
show tables from `${catalog}`
               ]]>
            </SQL>
         </Else>
      </Command>

      <Command id="mysql.getTable">
         <SQL>
            <![CDATA[
show table status from `${catalog}` like '${table}'
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getCreateObject">
         <SQL>
            <![CDATA[
show create ${type} `${catalog}`.`${name}`
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getProcedures">
         <SQL>
            <![CDATA[
select * from information_schema.routines
where routine_schema = '${catalog}'
and routine_name like '${name}'
and routine_type like '${type}'
order by routine_name
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getTriggers">
         <SQL>
            <![CDATA[
select *, concat(
'create trigger ', event_object_schema, '.', trigger_name, char(10),
action_timing, ' ', event_manipulation,' on ', char(10),
event_object_schema, '.', event_object_table, char(10),
'for each row ', action_statement) 'DDL'
from information_schema.triggers
where trigger_schema = '${catalog}'
and trigger_name like '${name}'
and event_object_table like '${type}'
order by trigger_name
            ]]>
         </SQL>
      </Command>

      <!-- ================================================================= -->
      <!-- DBA related commands requiring certain privileges in the database -->
      <!-- ================================================================= -->

      <Command id="mysql.getUsers">
         <SQL>
            <!-- UTF8 support was added in MySQL 4.1 -->
            <If test="(#dm.getDatabaseMajorVersion() eq 4 and
                       #dm.getDatabaseMinorVersion() gte 1) or
                       #dm.getDatabaseMajorVersion() gte 5">
               <![CDATA[
select CONCAT('''', User, '''', _utf8'@', '''', Host, '''') as UserName, mysql.user.*
from mysql.user where user != '' order by UserName
                ]]>
            </If>
            <Else>
               <![CDATA[
select CONCAT('''', User, '''@''', Host, '''') as UserName, mysql.user.*
from mysql.user where user != '' order by UserName
               ]]>
            </Else>
         </SQL>
      </Command>

      <Command id="mysql.getUser">
         <SQL>
            <![CDATA[
show grants for ${user}
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getProcessList">
         <SQL>
            <![CDATA[
show processlist
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getStatus">
         <SQL>
            <![CDATA[
show status
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getVariables">
         <SQL>
            <![CDATA[
show variables
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getTableEngines">
         <SQL>
            <![CDATA[
show engines
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getErrors">
         <SQL>
            <![CDATA[
show errors
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getPrivileges">
         <SQL>
            <![CDATA[
show privileges
            ]]>
         </SQL>
      </Command>

      <Command id="mysql.getTableDDL">
         <SQL>
            <![CDATA[
show create table
            ]]>
         </SQL>
      </Command>

   </Commands>

   <!-- =================================================================== -->
   <!-- Definition of the object actions that are used by the tree and views -->
   <!-- =================================================================== -->

   <ObjectsActionDef extends="false">

      <ActionGroup type="Databases">
         <Action id="mysql-databases-create" label="Create Database" reload="true"
                 resetcatalogs="true" icon="add">
            <Input label="Database Name" name="newCatalog" style="text" editable="true"/>
            <Command>
               <SQL><![CDATA[create database `${newCatalog}`]]></SQL>
            </Command>
            <Confirm>
               Create database ${newCatalog}?
            </Confirm>
            <Result>
               Database ${newCatalog} created!
            </Result>
         </Action>
      </ActionGroup>

      <ActionGroup type="Catalog">
         <Action id="mysql-catalog-drop" label="Drop Database" reload="true"
                 resetcatalogs="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Command><SQL><![CDATA[drop database `${catalog}`]]></SQL></Command>
            <Confirm>
               <![CDATA[
                 Really drop database ${catalog}?<br>
                 (All data will be lost!)
               ]]>
            </Confirm>
            <Result>
               Database ${catalog} dropped!
            </Result>
         </Action>
         <Action id="mysql-schema-export" label="Export Database"
                 icon="export" reload="false"
                 class="schemaExport"
                 doclink="http://www.dbvis.com/doclink/export-schema"/>
      </ActionGroup>

      <ActionGroup type="Tables">
         <Action id="mysql-tables-create-table" label="Create Table"
                 icon="add" reload="true"
                 class="tableCreateOrAlter"
                 classargs="create"
                 doclink="http://www.dbvis.com/doclink/create-table"/>
         <Action id="mysql-new-table-import-data"
                 label="Import Table Data"
                 icon="import"
                 class="tableDataImport"
                 doclink="http://www.dbvis.com/doclink/import-table"/>
      </ActionGroup>

      <ActionGroup type="Table">
         <Action id="mysql-tables-alter-table" label="Alter Table"
                 icon="edit" reload="true"
                 class="tableCreateOrAlter"
                 classargs="alter"
                 doclink="http://www.dbvis.com/doclink/alter-table"/>

         <Action id="mysql-table-rename" label="Rename Table" reload="true" icon="rename">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Table" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Input label="New Database" name="newCatalog" style="list">
               <Values>
                  <Command><SQL><![CDATA[show databases]]></SQL></Command>
               </Values>
               <Default>${catalog}</Default>
            </Input>
            <Input label="New Table Name" name="newTable" style="text"/>
            <Command>
               <SQL><![CDATA[rename table `${catalog}`.`${objectname}` to `${newCatalog}`.`${newTable}`]]></SQL>
            </Command>
            <Confirm>
               Confirm rename of ${catalog}.${objectname} to ${newCatalog}.${newTable}?
            </Confirm>
            <Result>
               Table ${catalog}.${objectname} renamed to ${newCatalog}.${newTable}!
            </Result>
         </Action>

         <Action id="mysql-table-clear" label="Empty Table" reload="true">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Table" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Input label="Use Command" name="useCommand" style="radio">
               <Values>TRUNCATE|DELETE</Values>
               <Default>TRUNCATE</Default>
            </Input>

            <SetVar name="_command" value="#useCommand.equals('TRUNCATE') ? 'truncate table' : 'delete from'"/>

            <Command>
               <SQL><![CDATA[${_command} `${catalog}`.`${objectname}`]]></SQL>
            </Command>
            <Confirm>
               Really remove all rows in table ${catalog}.${objectname}?
            </Confirm>
            <Result>
               All rows in table ${catalog}.${objectname} has been removed!
            </Result>
         </Action>

         <Action id="mysql-table-drop" label="Drop Table" reload="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Table" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command><SQL><![CDATA[drop table `${catalog}`.`${objectname}`]]></SQL></Command>
            <Confirm>
               Really drop table ${catalog}.${objectname}?
            </Confirm>
            <Result>
               Table ${catalog}.${objectname} has been dropped!
            </Result>
         </Action>

         <Action id="mysql-table-import-data" label="Import Table Data" icon="import"
                 class="tableDataImport"
                 doclink="http://www.dbvis.com/doclink/import-table"/>

         <Action id="mysql-table-export" label="Export Table" icon="export"
                 class="tableExport"
                 doclink="http://www.dbvis.com/doclink/export-table"/>
            
         <Separator/>

         <Action id="mysql-table-create-index" label="Create Index" reload="true">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Table" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Input label="Index Name" name="indexname" style="text"/>
            <Input label="Index Type" name="indextype" style="radio">
               <Labels>Unique|Fulltext|Default</Labels>
               <Values>unique|fulltext|</Values>
               <Default>unique</Default>
            </Input>
            <SetVar name="_indextype" value='#indextype.equals("") ? "" : " " + #indextype'/>

            <Input label="Columns" style="separator"/>

            <Input name="columns" style="grid">
               <Arg name="output" value="`${columnname}`${_sortorder}"/>
               <Arg name="newline" value=", "/>

               <Input name="columnname" label="Column Name" style="list">
                  <Values column="4">
                     <Command idref="getColumnNamesFor">
                        <Input name="table_catalog" value="${catalog}"/>
                        <Input name="table_schema" value="${schema}"/>
                        <Input name="table_name" value="${objectname}"/>
                     </Command>
                  </Values>
                  <Default>${0}</Default>
               </Input>
               <Input name="sortorder" label="Sort Order" style="radio">
                  <Labels>ASC|DESC|Default</Labels>
                  <Values>ASC|DESC|</Values>
                  <Default>ASC</Default>
               </Input>
               <SetVar name="_sortorder" value='#sortorder.equals("") ? "" : " " + #sortorder'/>
            </Input>

            <SetVar name="_columns" value='#columns.trim().equals("") ? "" : "(" + #columns + ")"'/>
            <SetVar name="_indexname" value='#indexname.trim().equals("") ? "" : " `" + #indexname + "`"'/>

            <Command>
               <SQL>
                  <![CDATA[create${_indextype} index${_indexname} on `${catalog}`.`${objectname}` ${_columns}]]>
               </SQL>
            </Command>
            <Confirm>
               <![CDATA[Create index "${indexname}"?]]>
            </Confirm>
            <Result>
               <![CDATA[Index "${indexname}" created!]]>
            </Result>
         </Action>
         
         <Action id="mysql-tabletrigger-create" label="Create Trigger" icon="add" reload="true"
                 doclink="http://www.dbvis.com/doclink/create-trigger">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Trigger" name="triggerName" style="text"/>
            <Input label="Trigger Time" name="triggerTime" style="radio">
               <Values>BEFORE|AFTER</Values>
               <Default>AFTER</Default>
            </Input>
            <Input label="Trigger Event" name="triggerEvent" style="radio">
               <Values>DELETE|INSERT|UPDATE</Values>
               <Default>INSERT</Default>
            </Input>
            <Input label="Table" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Input label="Source" style="separator"/>
            <Input name="source" style="text-editor">
               <Default><![CDATA[
--
--  Insert your own trigger code here
--
    insert into anotherTable (col1, col2) values(val1, val2);]]>
               </Default>
            </Input>

            <Command parsesql="false">
               <SQL><![CDATA[
create trigger `${catalog}`.`${triggerName}`
  ${triggerTime} ${triggerEvent}
  on `${catalog}`.`${objectname}`
  for each row begin
${source}
end;]]>
               </SQL>
            </Command>
            <Result>
               <![CDATA[Trigger <b>${catalog}.${triggerName}</b> created.]]>
            </Result>
         </Action>

         <Separator/>

         <Action id="mysql-table-script" label="Script Table" icon="scriptObject"
                 class="sqlBuilder"
                 classargs="script-dialog,SELECT,SELECT *,INSERT,UPDATE,DELETE,CREATE,DROP"/>
      </ActionGroup>

      <ActionGroup type="View">
         <Action id="mysql-view-drop" label="Drop View" reload="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="View" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command><SQL><![CDATA[drop view `${catalog}`.`${objectname}`]]></SQL></Command>
            <Confirm>
               Really drop view ${catalog}.${objectname}?
            </Confirm>
            <Result>
               View ${catalog}.${objectname} has been dropped!
            </Result>
         </Action>

         <Action id="mysql-view-rename" label="Rename View" reload="true" icon="rename">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="View" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Input label="New View Name" name="newTable" style="text"/>
            <Command>
               <SQL><![CDATA[rename table `${catalog}`.`${objectname}` to `${newTable}`]]></SQL>
            </Command>
            <Confirm>
               Confirm rename of ${catalog}.${objectname} to ${catalog}.${newTable}?
            </Confirm>
            <Result>
               View ${catalog}.${objectname} renamed to ${catalog}.${newTable}!
            </Result>
         </Action>

         <Action id="mysql-view-export" label="Export View" icon="export"
                 class="viewExport"
                 doclink="http://www.dbvis.com/doclink/export-view"/>

         <Separator/>
 
         <Action id="mysql-view-script" label="Script View" icon="scriptObject"
                 class="sqlBuilder"
                 classargs="script-dialog,SELECT,SELECT *,INSERT,UPDATE,DELETE,CREATE,DROP"/>
      </ActionGroup>

      <ActionGroup type="Index">
         <Action id="mysql-index-drop" label="Drop Index" reload="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Index" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command><SQL><![CDATA[drop index `${objectname}` on `${theTableName}`]]></SQL></Command>
            <Confirm>
               Really drop index ${catalog}.${objectname}?
            </Confirm>
            <Result>
               Index ${catalog}.${objectname} dropped!
            </Result>
         </Action>
      </ActionGroup>

      <ActionGroup type="Procedures">
         <Action id="mysql-procedures-create" label="Create Procedure" reload="true" icon="add"
                 doclink="http://www.dbvis.com/doclink/create-procedure">
            <Input label="Procedure Name" name="procedureName" style="text"/>

            <Input label="Parameters" style="separator"/>

            <Input label="Deterministic" name="deterministic" style="radio">
              <Values>NOT DETERMINISTIC|DETERMINISTIC</Values>
              <Default>NOT DETERMINISTIC</Default>
            </Input>
            <Input label="Access Option" name="option" style="list">
              <Values>CONTAINS SQL|READS SQL DATA|MODIFIES SQL DATA|NO SQL</Values>
              <Default>READS SQL DATA</Default>
            </Input>
            <Input name="parameters" style="grid">
               <Arg name="output" value="${direction} ${name} ${type}"/>
               <Arg name="newline" value=", "/>

               <Input name="name" label="Name" style="text">
                  <Default>parm</Default>
               </Input>
               <Input name="direction" label="Direction" style="list">
                  <Values>IN|INOUT|OUT</Values>
                  <Default>IN</Default>
               </Input>
               <Input name="type" label="Type" style="text">
                  <Default>VARCHAR(20)</Default>
               </Input>
            </Input>

            <SetVar name="_parameters" value='#parameters.trim().equals("") ? "()" : "(" + #parameters + ")"'/>
<!--
            <Input label="Source" style="separator"/>
            <Input name="source" style="text-editor">

               <Default>
                  <![CDATA[
BEGIN
  DECLARE v CHAR(10) DEFAULT 'Hello';
  SELECT CONCAT(v, ', ', current_user, '!');
END;
                  ]]>
               </Default>
            </Input>
-->
            <Command parsesql="false">
               <SQL>
                  <![CDATA[
CREATE PROCEDURE ${procedureName}
${_parameters}
${deterministic}
${option}
BEGIN
  DECLARE v CHAR(10) DEFAULT 'Hello';
  SELECT CONCAT(v, ', ', current_user, '!');
END;
                  ]]>
               </SQL>
            </Command>
            <Confirm>
               Create procedure ${procedureName}?
            </Confirm>
            <Result>
               Procedure ${procedureName} created!
            </Result>
         </Action>
      </ActionGroup>

      <ActionGroup type="Procedure">
         <Action id="mysql-procedure-drop" label="Drop Procedure" reload="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Procedure" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command><SQL><![CDATA[drop procedure `${catalog}`.`${objectname}`]]></SQL></Command>
            <Confirm>
               Really drop procedure ${catalog}.${objectname}?
            </Confirm>
            <Result>
               Procedure ${catalog}.${objectname} has been dropped!
            </Result>
         </Action>

         <Action id="mysql-procedure-export" label="Export Procedure" icon="export"
                 class="procedureExport"
                 doclink="http://www.dbvis.com/doclink/export-code-object"/>

         <Separator/>

         <Action id="mysql-procedure-script" label="Script Procedure" icon="scriptObject"
                 class="sqlBuilder"
                 classargs="script-dialog,CALL,CREATE,DROP"/>
      </ActionGroup>

      <ActionGroup type="Functions">
         <Action id="mysql-functions-create" label="Create Function" reload="true" icon="add"
                 doclink="http://www.dbvis.com/doclink/create-function">
            <Input label="Function Name" name="functionName" style="text"/>
            <Input label="Return Data Type" name="returns" style="text">
               <Default>VARCHAR(20)</Default>
            </Input>

            <Input label="Deterministic" name="deterministic" style="radio">
              <Values>NOT DETERMINISTIC|DETERMINISTIC</Values>
              <Default>NOT DETERMINISTIC</Default>
            </Input>
            <Input label="Access Option" name="option" style="list">
              <Values>CONTAINS SQL|READS SQL DATA|MODIFIES SQL DATA|NO SQL</Values>
              <Default>READS SQL DATA</Default>
            </Input>
            <Input label="Parameters" style="separator"/>

            <Input name="parameters" style="grid">
               <Arg name="output" value="${name} ${type}"/>
               <Arg name="newline" value=", "/>

               <Input name="name" label="Name" style="text">
                  <Default>parm</Default>
               </Input>
               <Input name="type" label="Type" style="text">
                  <Default>VARCHAR(20)</Default>
               </Input>
            </Input>

            <SetVar name="_parameters" value='#parameters.trim().equals("") ? "()" : "(" + #parameters + ")"'/>
<!--
            <Input label="Source" style="separator"/>
            <Input name="source" style="text-editor">

               <Default>
                  <![CDATA[
RETURN CONCAT('Hello, ', current_user, '!');
                  ]]>
               </Default>
            </Input>
-->
            <Command parsesql="false">
               <SQL>
                  <![CDATA[
CREATE FUNCTION ${functionName}
${_parameters}
RETURNS ${returns}
${deterministic}
${option}
RETURN CONCAT('Hello, ', current_user, '!');
                  ]]>
               </SQL>
            </Command>
            <Confirm>
               Create function ${functionName}?
            </Confirm>
            <Result>
               Function ${functionName} created!
            </Result>
         </Action>
      </ActionGroup>

      <ActionGroup type="Function">
         <Action id="mysql-function-drop" label="Drop Function" reload="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Function" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command><SQL><![CDATA[drop function `${catalog}`.`${objectname}`]]></SQL></Command>
            <Confirm>
               Really drop function ${catalog}.${objectname}?
            </Confirm>
            <Result>
               Function ${catalog}.${objectname} has been dropped!
            </Result>
         </Action>

         <Action id="mysql-function-export" label="Export Function" icon="export"
                 class="functionExport"
                 doclink="http://www.dbvis.com/doclink/export-code-object"/>

         <Separator/>

         <Action id="mysql-function-script" label="Script Function" icon="scriptObject"
                 class="sqlBuilder"
                 classargs="script-dialog,CALL,CREATE,DROP"/>
      </ActionGroup>

      <ActionGroup type="Process">
         <Action id="mysql-process-kill" label="Kill Session" reload="true" icon="remove">
            <Input label="User" style="text" editable="false">
               <Default>${mysql.getProcessList.User}</Default>
            </Input>
            <Input label="Host" style="text" editable="false">
               <Default>${mysql.getProcessList.Host}</Default>
            </Input>
            <Input label="Current Database" style="text" editable="false">
               <Default>${mysql.getProcessList.db}</Default>
            </Input>
            <Input label="Current Command" style="text" editable="false">
               <Default>${mysql.getProcessList.Command}: ${mysql.getProcessList.Info}</Default>
            </Input>
            <Input label="Id" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command>
               <SQL>
                  <![CDATA[kill ${objectname}]]>
               </SQL>
            </Command>
            <Confirm>
               Do you really want to kill id ${objectname}
               for user ${mysql.getProcessList.User}?
            </Confirm>
         </Action>
      </ActionGroup>

      <ActionGroup type="Trigger">
         <Action id="mysql-trigger-drop" label="Drop Trigger" reload="true" icon="remove">
            <Input label="Database" style="text" editable="false">
               <Default>${catalog}</Default>
            </Input>
            <Input label="Trigger" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command><SQL><![CDATA[drop trigger `${catalog}`.`${objectname}`]]></SQL></Command>
            <Confirm>
               Really drop trigger ${catalog}.${objectname}?
            </Confirm>
            <Result>
               Trigger ${catalog}.${objectname} has been dropped!
            </Result>
         </Action>

         <Action id="mysql-trigger-export" label="Export Trigger" icon="export"
                 class="triggerExport"
                 doclink="http://www.dbvis.com/doclink/export-code-object"/>

      </ActionGroup>

      <ActionGroup type="Users">
         <Action id="mysql-user-create" label="Create User" reload="true" icon="add">
            <Input label="User Name" name="userName" style="text">
                <Default>'user'@'host'</Default>
            </Input>
            <Input label="Password" name="password" style="password"/>
            <Command>
              <SQL><![CDATA[create user ${userName} identified by '${password}']]></SQL>
            </Command>
            <Result>
               <![CDATA[User <b>${userName}</b> created.]]>
            </Result>
         </Action>
      </ActionGroup>

      <ActionGroup type="Login">
         <Action id="mysql-user-drop" label="Drop User" reload="true" icon="remove">
            <Input label="User Name" style="text" editable="false">
               <Default>${objectname}</Default>
            </Input>
            <Command>
              <SQL><![CDATA[drop user ${objectname}]]></SQL>
            </Command>
            <Result>
               <![CDATA[User <b>${userName}</b> created.]]>
            </Result>
         </Action>
      </ActionGroup>

   </ObjectsActionDef>

   <!-- =================================================================== -->
   <!-- Definition of the database objects tree structure -->
   <!-- =================================================================== -->

   <ObjectsTreeDef extends="false">

      <GroupNode type="Databases" label="Databases">
         <DataNode type="Catalog" label="${getCatalogs.TABLE_CAT}">
            <SetVar name="catalog" value="${getCatalogs.TABLE_CAT}"/>

            <If test="#dp.SINGLE_DBNAME eq null">
               <Command idref="getCatalogs">
                  <Filter type="Catalog" name="Database">
                     <Column index="TABLE_CAT" name="Name"/>
                  </Filter>
               </Command>
            </If>
            <Else>
               <Command idref="mysql.getSingleDatabase">
                  <Output id="getCatalogs.TABLE_CAT" index="1"/>
                  <Filter type="Catalog" name="Database">
                     <Column index="TABLE_CAT" name="Name"/>
                  </Filter>
               </Command>
            </Else>

            <GroupNode type="Tables" label="Tables">
               <DataNode type="Table" label="${mysql.getTableNames.TABLE_NAME}" sort="mysql.getTableNames.TABLE_NAME">
                  <SetVar name="objectname" value="${mysql.getTableNames.TABLE_NAME}"/>
                  <SetVar name="rowcount" value="true"/>
                  <SetVar name="acceptInQB" value="true"/>
                  <Command idref="mysql.getTableNames">
                     <Input name="catalog" value="${catalog}"/>
                     <Input name="type" value="NOT IN ('VIEW')"/>
                     <Output id="mysql.getTableNames.TABLE_NAME" index="1"/>
                     <Filter type="Table" name="Table">
                        <Column index="1" name="Name"/>
                     </Filter>
                  </Command>

                  <!-- Need to keep the objectname for the current table in
                       a new variable so that the viewers will be able to pick up
                       the correct input to display -->
                  <SetVar name="theTableName" value="${objectname}"/>

                  <GroupNode type="Columns" label="Columns">
                     <DataNode type="Column" label="${getColumns.COLUMN_NAME}   (${getColumns.TYPE_NAME})" isLeaf="true">
                        <SetVar name="objectname" value="${getColumns.COLUMN_NAME}"/>
                        <Command idref="getColumns">
                           <Input name="catalog" value="${catalog}"/>
                           <Input name="objectname" value="${theTableName}"/>
                        </Command>
                     </DataNode>
                  </GroupNode>

                  <GroupNode type="Indexes" label="Indexes">
                     <DataNode type="Index" label="${getIndexes.INDEX_NAME}   (${getIndexes.ORDINAL_POSITION}: ${getIndexes.COLUMN_NAME})" isLeaf="true">
                        <SetVar name="objectname" value="${getIndexes.INDEX_NAME}"/>
                        <Command idref="getIndexes">
                           <Input name="catalog" value="${catalog}"/>
                           <Input name="objectname" value="${theTableName}"/>
                           <Output modelaction="removeisnullrows" index="INDEX_NAME"/>
                        </Command>
                     </DataNode>
                  </GroupNode>

                  <GroupNode type="Triggers" label="Triggers">
                     <DataNode type="Trigger" label="${mysql.getTriggers.TRIGGER_NAME}   (${mysql.getTriggers.EVENT_OBJECT_TABLE})" isLeaf="true">
                        <SetVar name="objectname" value="${mysql.getTriggers.TRIGGER_NAME}"/>
                        <Command idref="mysql.getTriggers">
                           <Input name="catalog" value="${catalog}"/>
                           <Input name="name" value="%"/>
                           <Input name="type" value="${theTableName}"/>
                        </Command>
                     </DataNode>
                  </GroupNode>
               </DataNode>
            </GroupNode>

            <!-- Views, Procedures and Functions were added in MySQL 5 -->
            <If test="#dm.getDatabaseMajorVersion() gte 5">
               <GroupNode type="Views" label="Views">
                  <DataNode type="View" label="${mysql.getTableNames.TABLE_NAME}" sort="mysql.getTableNames.TABLE_NAME" isLeaf="true">
                     <SetVar name="objectname" value="${mysql.getTableNames.TABLE_NAME}"/>
                     <SetVar name="rowcount" value="true"/>
                     <SetVar name="acceptInQB" value="true"/>
                     <Command idref="mysql.getTableNames">
                        <Input name="catalog" value="${catalog}"/>
                        <Input name="type" value="IN ('VIEW')"/>
                        <Output id="mysql.getTableNames.TABLE_NAME" index="1"/>
                        <Filter type="View" name="View">
                           <Column index="1" name="Name"/>
                        </Filter>
                     </Command>
                  </DataNode>
               </GroupNode>
               <GroupNode type="Procedures" label="Stored Procedures">
                  <DataNode type="Procedure" label="${mysql.getProcedures.ROUTINE_NAME}" isLeaf="true">
                     <SetVar name="objectname" value="${mysql.getProcedures.ROUTINE_NAME}"/>
                     <Command idref="mysql.getProcedures">
                        <Input name="catalog" value="${catalog}"/>
                        <Input name="name" value="%"/>
                        <Input name="type" value="PROCEDURE"/>
                        <Filter type="Procedure" name="Procedure">
                           <Column index="ROUTINE_NAME" name="Name"/>
                        </Filter>
                     </Command>
                  </DataNode>
               </GroupNode>
               <GroupNode type="Functions" label="User Functions">
                  <DataNode type="Function" label="${mysql.getProcedures.ROUTINE_NAME}" isLeaf="true">
                     <SetVar name="objectname" value="${mysql.getProcedures.ROUTINE_NAME}"/>
                     <Command idref="mysql.getProcedures">
                        <Input name="catalog" value="${catalog}"/>
                        <Input name="name" value="%"/>
                        <Input name="type" value="FUNCTION"/>
                        <Filter type="Function" name="Function">
                           <Column index="ROUTINE_NAME" name="Name"/>
                        </Filter>
                     </Command>
                  </DataNode>
               </GroupNode>
               <SetVar name="theTableName" value="%"/>
               <GroupNode type="Triggers" label="Triggers">
                  <DataNode type="Trigger" label="${mysql.getTriggers.TRIGGER_NAME}   (${mysql.getTriggers.EVENT_OBJECT_TABLE})" isLeaf="true">
                     <SetVar name="objectname" value="${mysql.getTriggers.TRIGGER_NAME}"/>
                     <Command idref="mysql.getTriggers">
                        <Input name="catalog" value="${catalog}"/>
                        <Input name="name" value="%"/>
                        <Input name="type" value="%"/>
                        <Filter type="Trigger" name="Trigger">
                           <Column index="TRIGGER_NAME" name="Name"/>
                        </Filter>
                     </Command>
                  </DataNode>
               </GroupNode>
            </If>

         </DataNode>
      </GroupNode>

      <GroupNode type="DBA" label="DBA Views">
         <GroupNode type="Users" label="Users">
            <DataNode type="Login" label="${mysql.getUsers.UserName}" isLeaf="true">
               <SetVar name="objectname" value="${mysql.getUsers.UserName}"/>
               <Command idref="mysql.getUsers">
                  <Output id="mysql.getUsers.UserName" index="1"/>
               </Command>

            </DataNode>
         </GroupNode>
         <If test="(#dm.getDatabaseMajorVersion() eq 4 and
                    #dm.getDatabaseMinorVersion() gte 1) or
                    #dm.getDatabaseMajorVersion() gte 5">

            <GroupNode type="Roles" label="Roles" isLeaf="true"/>
         </If>
         <GroupNode type="Processes" label="Processes" isLeaf="false">
            <DataNode type="Process" label="${mysql.getProcessList.User} (${mysql.getProcessList.Id}) ${mysql.getProcessList.db}" isLeaf="true">
               <SetVar name="objectname" value="${mysql.getProcessList.Id}"/>
               <Command idref="mysql.getProcessList"/>
            </DataNode>
         </GroupNode>
         <GroupNode type="Status" label="Status" isLeaf="true"/>

         <!-- Getting Table Engines was added in MySQL 4.1 -->
         <If test="(#dm.getDatabaseMajorVersion() eq 4 and
                    #dm.getDatabaseMinorVersion() gte 1) or
                    #dm.getDatabaseMajorVersion() gte 5">
            <GroupNode type="TableEngines" label="Table Engines" isLeaf="true"/>
            <!-- Errors were added in MySQL 5 -->
            <If test="#dm.getDatabaseMajorVersion() gte 5">
               <GroupNode type="Errors" label="Errors" isLeaf="true"/>
            </If>
         </If>
      </GroupNode>
   </ObjectsTreeDef>

   <!-- =================================================================== -->
   <!-- Definition of the database objects views -->
   <!-- =================================================================== -->

   <ObjectsViewDef extends="true">

      <ObjectView type="Databases">
         <DataView id="mysql-databases-databases" icon="Databases" label="Databases" viewer="grid">
            <Command idref="getCatalogs">
               <Output modelaction="rename" index="TABLE_CAT" name="Database"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Catalog">
         <!-- Drop all views since these are available for type="Tables" -->
         <DataView id="generic-catalog-tables" action="drop"/>
         <DataView id="generic-catalog-references" action="drop"/>
      </ObjectView>

      <ObjectView type="Tables">
         <DataView id="generic-tables-tables" action="drop"/>
         <DataView id="generic-tables-references" action="drop"/>

         <DataView id="mysql-tables-tables" icon="Tables" label="Tables" viewer="grid">
            <Input name="menuItem" value="Open in New Tab...">
               <Input name="action" value="open-object-in-new-tab-command ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>
            <Input name="menuItem" value="Open in Floating Tab...">
               <Input name="action" value="open-object-in-floating-tab-command ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>
            <Input name="menuItem" value="Script: SELECT ALL">
               <Input name="command" value="select * from ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>
            <Input name="menuItem" value="Script: DROP TABLE">
               <Input name="command" value="drop table ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>

            <Command idref="mysql.getTables">
               <Input name="catalog" value="${catalog}"/>
               <Input name="type" value="NOT IN ('VIEW')"/>
               <Output modelaction="rename" index="1" name="TABLE_NAME"/>
            </Command>
         </DataView>
         <DataView id="mysql-tables-references" icon="References" label="References" viewer="tables-refs"
                 doclink="http://www.dbvis.com/doclink/show-references">
            <Command idref="getTables">
               <Input name="catalog" value="${catalog}"/>
               <Input name="objectname" value="%"/>
               <Input name="tableType" value="TABLE"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Table">
         <DataView id="generic-table-info" action="drop"/>
         <DataView id="generic-table-columns" action="drop"/>

         <DataView id="mysql-table-info" icon="Info" label="Info" viewer="form" order-before="0">
            <Command idref="mysql.getTable">
               <Input name="catalog" value="${catalog}"/>
               <Input name="table" value="${objectname}"/>
            </Command>
         </DataView>

         <DataView id="mysql-table-columns" icon="Columns" label="Columns" viewer="grid" order-after="mysql-table-info">
            <Command idref="mysql.getColumns">
               <Input name="catalog" value="${catalog}"/>
               <Input name="table" value="${objectname}"/>
            </Command>
         </DataView>

         <DataView id="mysql-table-ddl" icon="Source" label="DDL" viewer="ddl">
            <Input name="formatSQL" value="true"/>
         </DataView>

         <DataView id="mysql-table-nativeddl" icon="Source" label="Native DDL" viewer="text">
            <Input name="dataColumn" value="Create Table"/>
            <Input name="formatSQL" value="false"/>

            <Command idref="mysql.getCreateObject">
               <Input name="catalog" value="${catalog}"/>
               <Input name="name" value="${objectname}"/>
               <Input name="type" value="TABLE"/>
            </Command>
            <Message>
               <![CDATA[
<html>
This view shows the DDL produced by the MySQL "SHOW CREATE TABLE" command.
</html>
               ]]>
            </Message>
         </DataView>

         <If test="#dm.getDatabaseMajorVersion() gte 5">
            <DataView id="mysql-table-triggers" icon="Triggers" label="Triggers" viewer="grid">
               <Command idref="mysql.getTriggers">
                  <Input name="catalog" value="${catalog}"/>
                  <Input name="name" value="%"/>
                  <Input name="type" value="${objectname}"/>
               </Command>
            </DataView>
         </If>
      </ObjectView>

      <ObjectView type="Views">
         <DataView id="mysql-views-views" icon="Views" label="Views" viewer="grid">
            <Input name="menuItem" value="Open in New Tab...">
               <Input name="action" value="open-object-in-new-tab-command ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>
            <Input name="menuItem" value="Open in Floating Tab...">
               <Input name="action" value="open-object-in-floating-tab-command ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>
            <Input name="menuItem" value="Script: SELECT ALL">
               <Input name="command" value="select * from ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>
            <Input name="menuItem" value="Script: DROP VIEW">
               <Input name="command" value="drop view ${catalog||catalog}${object||TABLE_NAME}"/>
            </Input>

            <Command idref="mysql.getTables">
               <Input name="catalog" value="${catalog}"/>
               <Input name="type" value="IN ('VIEW')"/>
               <Output modelaction="rename" index="1" name="TABLE_NAME"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="View">
         <DataView id="mysql-view-info" icon="Info" label="Info" viewer="node-form"/>

         <DataView id="mysql-view-columns" icon="Columns" label="Columns" viewer="grid">
            <Command idref="mysql.getColumns">
               <Input name="catalog" value="${catalog}"/>
               <Input name="table" value="${objectname}"/>
            </Command>
         </DataView>

         <DataView id="mysql-view-data" icon="Data" label="Data" viewer="table-data"/>

         <DataView id="mysql-view-rowcount" icon="RowCount" label="Row Count" viewer="table-rowcount"/>

         <DataView id="mysql-view-grants" icon="TablePrivileges" label="Grants" viewer="grid">
            <Command idref="getPrivileges">
               <Input name="catalog" value="${catalog}"/>
               <Input name="objectname" value="${objectname}"/>
            </Command>
         </DataView>

         <If test="#dm.getDatabaseMajorVersion() gte 5">
            <DataView id="mysql-view-ddl" icon="Source" label="DDL" viewer="ddl">
               <Input name="objectType" value="View"/>
               <Input name="formatSQL" value="true"/>
            </DataView>
         </If>
      </ObjectView>

      <ObjectView type="Columns">
         <DataView id="generic-columns-columns" action="drop"/>

         <DataView id="mysql-columns-columns" icon="Columns" label="Columns" viewer="grid">
            <Command idref="mysql.getColumns">
               <Input name="catalog" value="${catalog}"/>
               <Input name="table" value="${objectname}"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Procedures">
         <DataView id="generic-procedures-procedures" action="drop"/>

         <DataView id="mysql-procedures-storedprocedures" icon="Procedures" label="Stored Procedures" viewer="grid">
            <Command idref="mysql.getProcedures">
               <Input name="catalog" value="${catalog}"/>
               <Input name="name" value="%"/>
               <Input name="type" value="PROCEDURE"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Procedure">
         <DataView id="generic-procedure-columns" action="drop"/>

         <DataView id="mysql-procedure-procedureditor" icon="SourceEditor" label="Procedure Editor"
                   viewer="ProcedureViewer"
                   classargs="PROCEDURE"
                   doclink="http://www.dbvis.com/doclink/edit-code-object"/>
         <DataView id="mysql-procedure-info" icon="Info" label="Info" viewer="node-form"/>
      </ObjectView>

      <ObjectView type="Functions">
         <DataView id="mysql-functions-userfunctions" icon="Functions" label="User Functions" viewer="grid">
            <Command idref="mysql.getProcedures">
               <Input name="catalog" value="${catalog}"/>
               <Input name="name" value="%"/>
               <Input name="type" value="FUNCTION"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Function">
         <DataView id="mysql-function-functioneditor" icon="SourceEditor" label="Function Editor"
                   viewer="ProcedureViewer"
                   classargs="FUNCTION"
                   doclink="http://www.dbvis.com/doclink/edit-code-object"/>
         <DataView id="mysql-function-info" icon="Info" label="Info" viewer="node-form"/>
      </ObjectView>

      <ObjectView type="Triggers">
         <DataView id="mysql-triggers-triggers" icon="Triggers" label="Triggers" viewer="grid">
            <Command idref="mysql.getTriggers">
               <Input name="catalog" value="${catalog}"/>
               <Input name="name" value="%"/>
               <Input name="type" value="${theTableName}"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Trigger">
         <DataView id="mysql-trigger-triggereditor" icon="SourceEditor" label="Trigger Editor"
                   viewer="ProcedureViewer"
                   classargs="TRIGGER"
                   doclink="http://www.dbvis.com/doclink/edit-code-object"/>
         <DataView id="mysql-trigger-info" icon="Info" label="Info" viewer="node-form"/>
      </ObjectView>

      <!-- DBA Views -->
      <ObjectView type="Users">
         <DataView id="mysql-users-users" icon="Users" label="Users" viewer="grid">
            <Command idref="mysql.getUsers"/>
         </DataView>
      </ObjectView>

      <ObjectView type="Roles">
         <DataView id="mysql-roles-serverroles" icon="Roles" label="Server Roles" viewer="grid">
            <Command idref="mysql.getPrivileges"/>
         </DataView>
      </ObjectView>

      <ObjectView type="Login">
         <DataView id="mysql-login-grants" icon="Role" label="Grants" viewer="node-form">
            <Command idref="mysql.getUser">
               <Input name="user" value="${objectname}"/>
            </Command>
         </DataView>
      </ObjectView>

      <ObjectView type="Processes">
         <DataView id="mysql-processes-processes" icon="Processes" label="Processes" viewer="grid">
            <Command idref="mysql.getProcessList"/>
         </DataView>
      </ObjectView>

      <ObjectView type="Process">
         <DataView id="mysql-process-process" icon="Process" label="Process" viewer="node-form"/>
      </ObjectView>

      <ObjectView type="Status">
         <DataView id="mysql-status-status" icon="Status" label="Status" viewer="grid">
            <Command idref="mysql.getStatus"/>
         </DataView>
         <DataView id="mysql-status-variables" icon="Variables" label="Variables" viewer="grid">
            <Command idref="mysql.getVariables"/>
         </DataView>
      </ObjectView>

      <ObjectView type="Errors">
         <DataView id="mysql-errors-errors" icon="Errors" label="Errors" viewer="grid">
            <Command idref="mysql.getErrors"/>
         </DataView>
      </ObjectView>

      <ObjectView type="TableEngines">
         <DataView id="mysql-tableengine-tableengines" icon="TableEngine" label="Table Engines" viewer="grid">
            <Command idref="mysql.getTableEngines"/>
            <Message>
               <![CDATA[
<html>
MySQL supports several storage engines that act as handlers for different table types.
</html>
               ]]>
            </Message>
         </DataView>
      </ObjectView>

   </ObjectsViewDef>

</DatabaseProfile>
